{
    "collab_server" : "",
    "contents" : "library(tidyverse)\nlibrary(anytime)\nlibrary(lubridate)\nlibrary(stringr)\nlibrary(scales)\nlibrary(zoo)\nlibrary(treemap)\nlibrary(forcats)\nlibrary(d3Tree)\nlibrary(treemapify)\n\ncontributions <- read_delim('contributions_janjun2014.txt', delim = ';', col_names = F) %>% \n  rbind(read_delim('contributions_juldec2014.txt', delim = ';', col_names = F)) %>% \n  rbind(read_delim('contributions_janjun2015.txt', delim = ';', col_names = F)) %>% \n  rbind(read_delim('contributions_juldec2015.txt', delim = ';', col_names = F)) %>%\n  rbind(read_delim('contributions_janjun2016.txt', delim = ';', col_names = F)) %>%  \n  rbind(read_delim('contributions_juldec2016.txt', delim = ';', col_names = F)) %>% \n  rbind(read_delim('contributions_full2017.txt', delim = ';', col_names = F)) %>% \n  filter(X1 != 'BCF', X13 != 'TOTAL', X13 != 'IN-KIND RECD TOTAL')\n\nnames(contributions)<-c('Transaction Type','Election Date','Office Sought','Location of Office','Name Prefix','Last Name','First Name','Middle Name','Name Suffix','Party Affiliation','Report Due Date','Statement Type','Name','Address1','Address 2','City','State','Zip','Transaction Category','Form of Transaction','Occupation','Employer','Congressional District','Transaction Amount','Date of Transaction',\"Spouse's Name\",\"Spouse's Occupation\",\"Spouse's Employer\",'Organization Name','N/A','Transaction Mode')\nwrite_csv(contributions, 'KREF_Contributions_2014_2017.csv')\n\n\ncontributions %>% \n  mutate(\n    `Full Name` = pmap_chr(list(`Name Prefix`,`First Name`,`Last Name`), function(prefix,first,last){\n      if(is.na(prefix)) paste(first, last)\n      else paste(prefix, first, last)\n    }),\n    year = year(anytime(`Date of Transaction`))\n  ) %>% \n  filter(`Office Sought` == 'STATE REPRESENTATIVE') %>% \n  group_by(year, `Full Name`, Name) %>% \n  summarize(total = sum(`Transaction Amount`)) %>% \n  filter(year == 2016, !is.na(Name), !is.na(`Full Name`), `Full Name` != 'N/A', total > 5000) %>% \n  ggplot(aes(Name, total, fill = `Full Name`, label = total)) +\n  geom_bar(stat = 'identity', position = 'stack') +\n  # geom_label() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  coord_flip() +\n  ggtitle('State House Contributors > $5,000')\n\ncontributions_m <- contributions %>% \n  mutate(\n    `Full Name` = pmap_chr(list(`Name Prefix`,`First Name`,`Last Name`), function(prefix,first,last){\n      if(is.na(prefix)) paste(first, last)\n      else paste(prefix, first, last)\n    }),\n    year = year(anytime(`Date of Transaction`))\n  ) \n\ncontributions_m %>% \n  filter(year == 2016, !is.na(`Office Sought`)) %>% \n  group_by(`Office Sought`) %>% \n  summarize(Total = sum(`Transaction Amount`)) %>%\n  filter(Total > 100000) %>% \n  ggplot(aes(`Office Sought`, Total, label = dollar_format()(Total))) +\n  geom_bar(stat = 'identity') +\n  geom_label() +\n  coord_flip() +\n  ggtitle('Total Amount Raised by Office Sought (>$100,000)')\n\nname_text = 'S. COAN'\n\n\ncontributions_m %>% \n  filter(is.na(`Office Sought`)) %>% \n  write_csv('no_office_sought_2014_2017.csv')\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>% \n  group_by(Name, `Organization Name`, `Form of Transaction`) %>%\n  summarize(`Total Given` = sum(`Transaction Amount`)) %>% \n  arrange(`Total Given` %>% desc()) %>% \n  treemap(index = 'Name', vSize = 'Total Given')\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>% \n  group_by(Name, `Organization Name`, `Form of Transaction`) %>%\n  summarize(`Total Given` = sum(`Transaction Amount`)) %>%\n  ungroup() %>% \n  summarize(`Number of Donors` = n())\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>% \n  group_by(Name, `Organization Name`, `Form of Transaction`) %>%\n  summarize(`Total Given` = sum(`Transaction Amount`)) %>% \n  ungroup() %>% \n  summarize(`Mean Contributior Amount` = mean(`Total Given`))\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>% \n  group_by(Name, `Organization Name`, `Form of Transaction`) %>%\n  summarize(`Total Given` = sum(`Transaction Amount`)) %>% \n  ungroup() %>% \n  summarize(`Median Contributior Amount` = median(`Total Given`))\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>% \n  group_by(Name, `Organization Name`, `Form of Transaction`) %>%\n  summarize(`Total Given` = sum(`Transaction Amount`)) %>% \n  arrange(`Total Given` %>% desc()) %>% \n  ggplot(aes(x =`Total Given`)) + \n  geom_histogram(binwidth = 500) +\n  scale_x_continuous(labels = dollar_format()) +\n  labs(title = 'Total Given Histogram', x = '')\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>% \n  group_by(Name, `Organization Name`, `Form of Transaction`) %>%\n  summarize(`Total Given` = sum(`Transaction Amount`)) %>% \n  arrange(`Total Given` %>% desc()) %>% \n  ggplot(aes(x= 1, y =`Total Given`, fill = 'A')) + \n  geom_violin(show.legend = F) +\n  geom_boxplot(aes(fill = 'B', alpha = 0.6), width = 0.1, show.legend = F) +\n  scale_y_continuous(labels = dollar_format()) +\n  scale_fill_manual(values = c('dodgerblue', 'grey')) +\n  labs(title = 'Total Given Violin Plot', x = '') +\n  theme_minimal() +\n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank()) +\n  coord_flip()\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>%\n  summarize(`Total Given` = sum(`Transaction Amount`))\n\ncontributions_m %>% \n  filter(`Full Name` == name_text, `Form of Transaction` != 'IN KIND') %>% \n  group_by(Name, `Organization Name`, `Form of Transaction`) %>%\n  summarize(`Total Given` = sum(`Transaction Amount`)) %>% \n  arrange(`Total Given` %>% desc())\n\n\ntreemapify(df)\n\n\ncontributions %>% \n  filter(election_year == 2016,\n         `Office Sought` == 'CITY COUNCIL MEMBER',\n         `Last Name` == 'SCHLOSSER') %>% View()\n",
    "created" : 1496436078943.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "198366116",
    "id" : "CA3A852F",
    "lastKnownWriteTime" : 1496525728,
    "last_content_update" : 1496525728508,
    "path" : "C:/Users/rkahn/Google Drive/R/contributions/contributions.R",
    "project_path" : "contributions.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}